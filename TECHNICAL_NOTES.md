# Technical Notes

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è,
–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ ETL-–ø–∞–π–ø–ª–∞–π–Ω–æ–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
–∏–∑ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –≤ ClickHouse —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
–≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ (Power BI).

–§–æ–∫—É—Å —Å–¥–µ–ª–∞–Ω –Ω–µ –Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ –∫–æ–¥–∞, –∞ –Ω–∞:
- –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–∞—Ö,
- –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤,
- –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–∞—Ö,
- –ø—Ä–∏—á–∏–Ω–∞—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π.

---

## 1. –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç ETL-–ø–∞–π–ø–ª–∞–π–Ω—ã –Ω–∞ Python –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:

- **OData (1–° / ERP)**  
- **Bitrix24 (CRM)**  
- **Google Sheets (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ –∏ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)**  

ClickHouse –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫:
- —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ;
- –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Å–ª–æ–π –º–µ–∂–¥—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –∏ Power BI;
- –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

---

## 2. OData ‚Üí ClickHouse

### 2.1 –¶–µ–ª—å

–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤ –∏ —Å–≤—è–∑–∞–Ω–Ω—É—é –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
–∏–∑ OData API (1–°) –≤ ClickHouse –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ
–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å CRM-–¥–∞–Ω–Ω—ã–º–∏.

---

### 2.2 –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã OData:

- `$top / $skip` ‚Äî –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è;
- `$orderby=Ref_Key` ‚Äî –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–≥—Ä—É–∑–∫–∏.

–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥:
- –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π –æ—Ö–≤–∞—Ç –¥–∞–Ω–Ω—ã—Ö;
- –∏—Å–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∏ –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö;
- –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å –≤—ã–≥—Ä—É–∑–∫–∏.

---

### 2.3 –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ OData-—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã:

- –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (retries);
- —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (backoff);
- —Ç–∞–π–º–∞—É—Ç—ã HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ —Å–±–æ–∏;
- –∏–∑–±–µ–≥–∞—Ç—å –ø–∞–¥–µ–Ω–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞ –∏–∑-–∑–∞ –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ API.

---

### 2.4 –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö

–í–æ –≤—Ä–µ–º—è –≤—ã–≥—Ä—É–∑–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö:

- –∫–æ–Ω—Ç—Ä–æ–ª—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –±–∏–∑–Ω–µ—Å-–∫–ª—é—á–∞ `Ref_Key` –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏;
- –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∫–ª—é—á–µ–π, –µ—Å–ª–∏ –æ–Ω–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã.

–î–∞–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –≤—ã—è–≤–ª—è—Ç—å –∞–Ω–æ–º–∞–ª–∏–∏ –≤ OData-–≤—ã–≥—Ä—É–∑–∫–µ;
- –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞.

---

### 2.5 –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏

–ù–∞ —ç—Ç–∞–ø–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:

- –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –¥–∞—Ç –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É;
- –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π;
- –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ñ–ª–∞–≥–æ–≤ –∫ —á–∏—Å–ª–æ–≤–æ–º—É –≤–∏–¥—É (`UInt8`);
- –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤.

#### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
–¢–µ–ª–µ—Ñ–æ–Ω–Ω—ã–µ –Ω–æ–º–µ—Ä–∞ –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ —Ñ–æ—Ä–º–∞—Ç—É `7XXXXXXXXXX`, —á—Ç–æ:
- —É–ø—Ä–æ—â–∞–µ—Ç —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏ (1–° ‚Üî CRM);
- —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥—É–±–ª–µ–π;
- –æ–±–ª–µ–≥—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ join-–æ–ø–µ—Ä–∞—Ü–∏–∏.

---

### 2.6 –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π

–î–∞–Ω–Ω—ã–µ –∏–∑ OData —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –Ω–∞ –¥–≤–µ —Ç–∞–±–ª–∏—Ü—ã:

- `Kontragenty` ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞;
- `Kontragenty_Contact` ‚Äî –∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—Ç–µ–ª–µ—Ñ–æ–Ω—ã).

–¢–∞–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:
- —É–º–µ–Ω—å—à–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö;
- —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏;
- —É–ø—Ä–æ—â–∞–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã.

---

### 2.7 –ó–∞–≥—Ä—É–∑–∫–∞ –≤ ClickHouse

–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

- –ø–∞–∫–µ—Ç–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö (batch inserts);
- –∫–æ–Ω—Ç—Ä–æ–ª—å —Ä–∞–∑–º–µ—Ä–∞ –±–∞—Ç—á–µ–π –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏;
- –¥–≤–∏–∂–æ–∫ `ReplacingMergeTree` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫.

–¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏.

---

### 2.8 –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ (full refresh)**:

- —Ü–µ–ª–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –æ—á–∏—â–∞—é—Ç—Å—è –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π;
- –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞.

–î–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –≤—ã–±—Ä–∞–Ω –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ –∏ –ø–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—Å–∞–Ω –≤ —Ä–∞–∑–¥–µ–ª–µ 4.

---

## 3. Bitrix24 ‚Üí ClickHouse (CRM)

https://github.com/Sergeynikulin20/powerbi-analytics-dashboard/blob/main/src/bitrix/contacts_sync.py

### 3.1 –û–±—â–∏–π –ø–æ–¥—Ö–æ–¥

–î–ª—è –¥–∞–Ω–Ω—ã—Ö Bitrix24 —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:

- –≤—ã–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ REST API;
- –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è;
- watermark –ø–æ –¥–∞—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (`DATE_MODIFY`);
- –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö –∏ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π.

---

### 3.2 –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

–î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

- `ReplacingMergeTree` —Å –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ–π –∫–æ–ª–æ–Ω–∫–æ–π (`UPDATED_AT`);
- –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ª–æ–≥–∏—á–µ—Å–∫–∏–º –¥—É–±–ª—è–º;
- –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –∑–∞–ø–∏—Å–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

---

### 3.3 –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏

–ü–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è:

- –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª–µ–π (ID, —Å—É–º–º—ã);
- –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –¥–∞—Ç –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É;
- –æ—á–∏—Å—Ç–∫–∞ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.

---

### 3.4 –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∫–æ–¥–∞

ETL-–∫–æ–¥ Bitrix24 –Ω–µ –≤–∫–ª—é—á—ë–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ü–µ–ª–∏–∫–æ–º, —Ç–∞–∫ –∫–∞–∫:
- —Å–æ–¥–µ—Ä–∂–∏—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è;
- –ª–æ–≥–∏–∫–∞ —Å—Ö–æ–∂–∞ —Å –¥—Ä—É–≥–∏–º–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞–º–∏;
- –∞–∫—Ü–µ–Ω—Ç –ø—Ä–æ–µ–∫—Ç–∞ —Å–¥–µ–ª–∞–Ω –Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –∞ –Ω–µ –Ω–∞ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è –∫–æ–¥.

---

## 4. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–ü—Ä–∏—Ö–æ–¥–î–° + –°–ø–∏—Å–∞–Ω–∏–µ–î–°)

### 4.1 –ó–∞–¥–∞—á–∞

–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ñ–∞–∫—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ:
- –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–π –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤;
- —Å–ø–∏—Å–∞–Ω–∏–π –¥–µ–Ω–µ–∂–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤.

–†–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
- Power BI;
- –¥—Ä—É–≥–∏–º–∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –∏ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏.

---

### 4.2 –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã

| –ü–æ–¥—Ö–æ–¥ | –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞ |
|------|---------------|
| –¢–æ–ª—å–∫–æ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç | –ò—Å—Ç–æ—á–Ω–∏–∫ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ–ª–Ω—ã–µ –≤—ã–≥—Ä—É–∑–∫–∏ |
| Materialized View | –ü—Ä–∏ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ–∑–¥–∞—ë—Ç –∫—Ä–∞—Ç–Ω—ã–µ –¥—É–±–ª–∏ |
| Atomic swap (old/new) | –ù–∞—Ä—É—à–∞–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å –≤–Ω–µ—à–Ω–∏–º–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º–∏ |

---

### 4.3 –ü—Ä–∏–Ω—è—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **batch-–ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã**:

- –æ—á–∏—Å—Ç–∫–∞ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã;
- –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤ (UNION –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏–π –∏ —Å–ø–∏—Å–∞–Ω–∏–π);
- –ø–æ–ª–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö.

–ü—Ä–∏—á–∏–Ω—ã –≤—ã–±–æ—Ä–∞:

- —Ç–∞–±–ª–∏—Ü–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏;
- –≤–∞–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏–º—è —Ç–∞–±–ª–∏—Ü—ã;
- `ReplacingMergeTree` —É–¥–∞–ª—è–µ—Ç –¥—É–±–ª–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏;
- materialized views –Ω–µ –ø–æ–¥—Ö–æ–¥—è—Ç –ø—Ä–∏ full reload.

–ö—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞–Ω–Ω—ã—Ö:
- –¥–æ–ø—É—Å—Ç–∏–º–æ;
- –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π;
- –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ–Ω–µ—á–Ω—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É.

---

## 5. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

ETL-–ø–∞–π–ø–ª–∞–π–Ω—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é:
- task scheduler;
- —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º Power BI.

–õ–æ–≥–∏–∫–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á—Ç–æ–±—ã:
- –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∫ –º–æ–º–µ–Ω—Ç—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç—á—ë—Ç–æ–≤;
- –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫–Ω–∞ –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

---

## 6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Power BI

Power BI –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ ClickHouse —á–µ—Ä–µ–∑ **ODBC-–¥—Ä–∞–π–≤–µ—Ä**.

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –µ–¥–∏–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å —Å—Ç—Ä–æ—è—Ç—Å—è –≤ Power BI;
- ClickHouse –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–∫—Ç–æ–≤;
- –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –∫—Ä–µ–¥–µ–Ω—à–µ–ª—ã –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

---

## 7. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –≤—Å–µ –ª–æ–≥–∏–Ω—ã, –ø–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã –∏ URL –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è;
- –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–æ–ª—å–∫–æ `.env.example`;
- —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è.

---

## 8. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–µ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã

- –æ—Ç–∫–∞–∑ –æ—Ç materialized views –≤ –ø–æ–ª—å–∑—É –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö;
- –æ—Ç–∫–∞–∑ –æ—Ç atomic swap –∏–∑-–∑–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º–∏;
- –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –æ–∫–Ω–∞ –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–¥–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏;
- –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –Ω–∞–¥ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π.

---

## 9. –†–µ–∑—é–º–µ

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç:
- –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫—É—é —Ä–∞–±–æ—Ç—É —Å ETL –Ω–∞ Python;
- –ø–æ–Ω–∏–º–∞–Ω–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π ClickHouse;
- –æ–ø—ã—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ OData, CRM –∏ —Å–ø—Ä–∞–≤–æ—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤;
- –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –≤—ã–±–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –∏ –∫–æ–º–ø—Ä–æ–º–∏—Å—Å–æ–≤.

–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∏–Ω–∂–µ–Ω–µ—Ä–Ω–æ–µ –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ,
–∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤.

## Architecture Overview

```text
[1C / OData] ‚îÄ‚îê
               ‚îú‚îÄ> [Python ETL] ‚Üí [ClickHouse] ‚Üí [Power BI]
[Bitrix24] ‚îÄ‚îÄ‚îÄ‚îÄ‚î§        ‚Üë
[Google Sheets]‚îò   (facts & dimensions)
```
ClickHouse acts as a centralized analytical layer between operational systems and BI.

## –ü—Ä–∏–º–µ—Ä ETL: OData ‚Üí ClickHouse (–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã)

–ë–æ–µ–≤–æ–π ETL-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤ –∏–∑ OData (1–° / ERP)
–≤ ClickHouse —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –ø–∞–∫–µ—Ç–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π:

üîó `src/odata/kontragenty_etl.py`  
[https://github.com/Sergeynikulin20/blob/main/src/odata/kontragenty_etl.py](https://github.com/Sergeynikulin20/powerbi-analytics-dashboard/blob/main/src/odata/kontragenty_etl.py)

–°–∫—Ä–∏–ø—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç:
- –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—É—é –≤—ã–≥—Ä—É–∑–∫—É OData (`$top/$skip`, `$orderby`)
- retries –∏ backoff –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
- –±–∞–∑–æ–≤—ã–µ DQ-–ø—Ä–æ–≤–µ—Ä–∫–∏ (—É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å `Ref_Key`)
- –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
- –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse –±–∞—Ç—á–∞–º–∏

–ê–≤—Ç–æ—Ä

–°–µ—Ä–≥–µ–π –ü–µ—Ç—Ä–æ—á–µ–Ω–∫–æ Data Analyst / BI Analyst
